\chap{Thymio en mouvement}\label{c.moving}

\sect{En avant, en arrière}

Thymio a deux moteurs, un sur chaque roue.
Ils peuvent tourner dans les deux sens, permettant à Thymio d'avancer, de reculer et de tourner. Commençons par un petit programme qui vous apprendra à contrôler les moteurs.

Le bloc d'action des moteurs \blksm{action-motors} représente Thymio entouré de deux \textit{sliders}.
Chaque \textit{slider} contrôle un moteur.
En les faisant glisser vers l'avant, Thymio avancera, à l'inverse, en les faisant glisser vers l'arrière, Thymio reculera.
Pour arrêter le moteur, il suffit de glisser les \textit{sliders} au centre des barres.
Écrivons un programme qui fasse avancer Thymio lorsque le bouton avant est touché et qui le fait reculer si vous touchez sur le bouton arrière.

{\raggedleft \hfill Programme \bu{moving.aesl}}

Nous allons avoir besoin de deux paires événement-action. Une pour faire avancer Thymio, l'autre pour le faire reculer, comme sur \cref{fig.nostop}. Faites glisser les blocs correspondants dans le canevas, réglez le bouton que vous souhaitez utiliser et ajustez les \textit{sliders} des moteurs pour faire avancer Thymio dans un cas et pour le faire reculer dans l'autre. Plus vous tirerez les \textit{sliders} vers l'avant ou l'arrière, plus les moteurs tourneront vite. Essayez d'abord avec une vitesse moyenne.

\begin{figure}
\begin{center}
\gr{no-stop-motors}{.4}
\caption{Thymio avance et recule}\label{fig.nostop}
\end{center}
\end{figure}

Démarrez maintenant le programme en cliquant sur \blksm{run} et touchez les boutons avant et arrière pour voir si Thymio avance et recule!

\sect{Arrête-toi!}

\textbf{À l'aide !} Thymio ne veut plus s'arrêter !

Cliquez sur l'icône \blksm{stop} pour arrêter Thymio.
Nous allons corriger ce problème en ajoutant une paire événement-action dans le programme: \blkc{stop-motors}
Avec ces deux blocs, Thymio s'arrêtera lorsqu'on presse son bouton centrale.
Lorsque vous ajoutez un bloc moteur dans le programme, il vient directement avec les \textit{sliders} réglés pour que les moteurs s'arrêtent.

\sect{Ne tombe pas de la table}

Si Thymio se trouve sur le sol, au pire, il rentrera dans un mur ou se débranchera tout seul de votre ordinateur, mais s'il est sur une table, il risque de tomber !
Nous allons créer un petit programme qui lui permettra de s'arrêter s'il arrive au bord de la table.

\warningbox{Si Thymio roule sur une table, tenez-vous toujours prêt à le rattraper s'il arrive près du bord de la table!}

Tournez Thymio sur son dos. Vous verrez deux petits rectangles noirs qui contiennent des éléments optiques, comme nous le voyons sur le haut de la \cref{fig.bottom}.
Ce sont les \emph{détecteurs de sols} !
Ils envoyent une impulsion de lumière infrarouge et mesurent la quantité de lumière qui leur est réféchie.
Si Thymio est posé sur une table de couleur claire, beaucoup de lumière sera réfléchie, alors que s'il est sur le dos, comme sur la \cref{fig.bottom}, ou qu'il dépasse le bord de la table, peu de lumière sera réfléchie.
Nous allons donc utiliser ces capteurs pour dire à Thymio de s'arrêter lorsqu'il arrive au bord de la table.

\trickbox{
Nous supposons que la table est de couleur claire.
Si votre table est foncée, vous devrez modifier le programme.
Évitez les tables en verre transparent, elles ne réfléchiront probablement pas la lumière et Thymio croira qu'il n'est pas sur une table !}

Tirez le bloc détecteur de sols \blksm{event-ground} sur le canevas pour commencer.
Les deux petits carrés gris représentent les détecteurs de sols.
En cliquant sur ces carrés, ils passent de gris à rouge, à blanc puis à nouveau à gris, etc. Ces couleurs signifient:

\begin{itemize}
\item \textbf{Gris} : Le détecteur n'est pas utilisé.
\item \textbf{Rouge} : L'action associée est déclenchée s'il y a beaucoup de lumière réfléchie.
\item \textbf{Blanc} : L'action associée est déclenchée s'il y a peu de lumière réfléchie.
\end{itemize}

Pour faire que Thymio s'arrête au bord de la table, lorsque qu'il y a peu de lumière réfléchie, cliquez les carrés jusqu'à ce qu'ils soient blancs et créez la paire action-événement suivante : \blkc{dont-fall}

\begin{figure}
\begin{center}
\gr{bottom}{0.6}
\caption{Le dessous de Thymio avec ses détecteurs de sols}\label{fig.bottom}
\end{center}
\end{figure}

Placez Thymio près d'un bord d'une table de façon à ce qu'il soit face au bord et appuyez sur le bouton avant.
Il devrait avancer jusqu'au bord et s'y arrêter. 

\exercisebox{\thechapter.1}{Jouez avec le contrôle des moteurs de Thymio.
À sa vitesse maximale, est-il toujours capable de s'arrêter avant le bord de la table ?
Si non, à partir de quelle vitesse le robot ne peut plus s'arrêter ?
Pouvez-vous empêcher le robot de tomber s'il va en arrière ?
}

\trickbox{
Lorsque j'ai lancé le programme, le robot \emph{est} tombé.
La raison était que mon bureau a un bord arrondi ; d'ici à ce que le robot ait détecté un faible niveau de lumière, il n'était déjà plus stable et a basculé.
Si vous voulez arrêter Thymio un peu avant le bord de la table, vous pouvez placer une feuille noir, ou du ruban adhésif noir là où vous souhaitez qu'il s'arrête!}